<!DOCTYPE html>
<html>
  <meta charset="utf-8" />
  <head>
    <script src="leaflet-search-master\src\leaflet-search.js"></script>
    <link rel="stylesheet" href="leaflet-search-master\src\leaflet-search.css" />
    <link rel="stylesheet"
    href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.js" ></script>
    <script src="leaflet-search-master\src\leaflet-search.js"></script>

    <style>
      #map {
        width: 100%;
        height: 600px;
        box-shadow: 5px 5px 5px #888;
      }
      .info {
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
      }
      .info h2 {
        margin: 0 0 5px;
        color: rgb(219, 0, 248);
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      var owsrootUrl = "http://localhost:8080/geoserver/ows";

      var defaultParameters = {
        service: "WFS",
        version: "1.3.0", //cambia version
        request: "GetFeature",
        typeName: "earth:segmentos_embalses",
        outputFormat: "application/json",
      };

      var parameters = L.Util.extend(defaultParameters);

      var URL = owsrootUrl + L.Util.getParamString(parameters);

      function style(feature) {
        return {
          //fillColor: getColor(feature.properties.NAME.indexOf("Embalse")),
          fillColor: getColor(feature.properties.name),
          weight: 2,
          opacity: 1,
          color: "white",
          dashArray: "3",
          fillOpacity: 0.7,
        };
      }

      function getColor(d) {
        if (d == 0) {
          return "#000053";
        } else {
          return "#487BB6";
        }
      }

      function brillo(e) {
        var layer = e.target;
        layer.setStyle({
          fillColor: "yellow",
          weight: 5,
          color: "#666",
          dashArray: "",
          fillOpacity: 0.2,
        });
      }

      function ReseteoLuz(e) {
        embal.resetStyle(e.target);
        //info.update();
      }

      function Zoomem(e) {
        map.fitBounds(e.target.getBounds());
      }

      var embal = new L.geoJson(null, {
        //Aplicamos un estilo
        style: style,
        onEachFeature: function (feature, layer) {
          //funcion para aplicar en cada capa C:
          layer.bindPopup(feature.properties.name),
            layer.on({
              mouseover: brillo, // Evento que se activa al pasar el cursor sobre un objeto
              mouseout: ReseteoLuz, // Evento que se activa al alejar el cursor sobre un objeto
              click: Zoomem, // Evento que se activa al dar click sobre un objeto.
            }); //LAYER ON
        },
      });

      var osm = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          attribution:
            '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>' +
            "contributors",
          maxZoom: 18,
        }
      );

      var osmg = L.tileLayer(
        "http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",
        {
          attribution:
            '&copy; <a href="google.com">OpenStreetMap</a>' + "contributors",
          maxZoom: 18,
        }
      );

      var LimitesDem = L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
        layers: "limites_demarcacion",
        format: "image/png",
        transparent: true,
        tiled: true,
        attribution: "earth",
      });

      var Hidro = L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
        layers: "segmentos_rios",
        format: "image/png",
        transparent: true,
        tiled: true,
        attribution: "earth",
      });

      var map = L.map("map", {
        center: [41.66, -4.72],
        zoom: 8,
        layers: [osm, Hidro, LimitesDem],
        scrollWheelZoom: true,
      });

      var baseMaps = {
        "Open Street Map": osm,
        "Google Earth": osmg,
      };

      var overlayMaps = {
        "Limites D": LimitesDem,
        Hidrografia: Hidro,
        "Embalses": embal,
      };

      var title = L.control();

      title.onAdd = function (map) {
        var div = L.DomUtil.create("div", "info");
        div.innerHTML += "<h2>Parcial Unidad 5</h2> Luis Fernando Montoya Parra";
        return div;
      };
      title.addTo(map);

      var legend = L.control({ position: "bottomright" });
      legend.onAdd = function (map) {
        var div = L.DomUtil.create("div", "info legend");
        div.innerHTML +=
          '<img src="http://localhost:8080/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=parcial" height="100">';
        return div;
      };
      legend.addTo(map);

      var searchControl = new L.Control.Search({
        layer: embal,
        marker: false,
        propertyName: "name",
      });

      searchControl
        .on("search:locationfound", function (e) {
          e.layer.setStyle({ fillColor: "#3f0", color: "#0f0" });
        })

        .on("search:collapsed", function (e) {
          embal.eachLayer(function (layer) {
            embal.resetStyle(layer);
            info.update();
          });
        });

      function loadGeojson(data) {
        embal.addData(data);
        map.addLayer(embal);
      }

      $.ajax({
        url: URL,
        dataType: "json",
        success: loadGeojson,
      });

      L.control.layers(baseMaps, overlayMaps, searchControl).addTo(map);
      map.addControl(searchControl);
      L.control
        .scale({
          position: "bottomright",
          imperial: true,
        })
        .addTo(map);
    </script>
  </body>
</html>
