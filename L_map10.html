<!DOCTYPE html>
<html>
  <head>
    <script src=" https://unpkg.com/leaflet@1.6.0/dist/leaflet.js "></script>
    <link
      rel="stylesheet"
      href=" https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    />
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script src="https://unpkg.com/leaflet.vectorgrid@1.2.0"></script>


    <style>
      #map {
        width: 100%;
        height: 580px;
        box-shadow: 5px 5px 5px #888;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      //-----------------------------------------estilo para capa paises
      function estilo_paises(feature) {
        return {
          stroke: "blue",
          fillColor: getColor(feature.properties.pop_est),
          weight: 2,
          opacity: 1,
          dashArray: "3",
          fillOpacity: 0.7,
        };
      }
      function getColor(d) {
        return d > 100000000
          ? "#800026"
          : d > 50000000
          ? "#BD0026"
          : d > 20000000
          ? "#E31A1C"
          : d > 10000000
          ? "#FC4E2A"
          : d > 5000000
          ? "#FD8D3C"
          : d > 2000000
          ? "#FEB24C"
          : d > 1000000
          ? "#FED976"
          : "#FFEDA0";
      }
      //----------------------------------------------------------------
      var owsrootUrl = "http://localhost:8080/geoserver/workgroup/ows";

      var defaultParameters = {
        service: "WFS",
        version: "1.0.0",
        request: "GetFeature",
        typeName: "paises",
        outputFormat: "application/json",
      };
      var parameters = L.Util.extend(defaultParameters);
      var URL = owsrootUrl + L.Util.getParamString(parameters);
      //------------------------------------------------------------------
      var OSM = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          attribution:
            '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>' +
            "contributors",
          maxZoom: 18,
        }
      );
      var map = L.map("map", {
        center: [1.614433, -75.609455],
        zoom: 5,
        layers: OSM,
      });
      L.control.scale().addTo(map);
      //-------------------estio capa ajax mosusover------------------------
      function highlightFeature(e) {
        var layer = e.target;
        layer.setStyle({
          fillColor: "blue",
          weight: 5,
          color: "#666",
          dashArray: "",
          fillOpacity: 0.3,
        });
        if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
          layer.bringToFront();
        }
      }
      var geojson;
      // Desilumina el barrio al quitar el mouse------------------------------
      function resetHighlight(e) {
        paisesG.resetStyle(e.target);
        info.update();
      }
      //-ZOOM a Poligono seleccionado-----------------------------------------
      function zoomToFeature(e) {
        map.fitBounds(e.target.getBounds());
      }
      function onEachFeature(feature, layer) {
        layer.bindPopup("Has hecho click en " + feature.properties.name),
          layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight,
            click: zoomToFeature,
          });
      }
      //-----------------------------------------CAPA AJAX-------------------
      var paisesG = new L.geoJson(null, {
        //Aplicamos un estilo
        style: estilo_paises, //{"color":"#2ECCFA","weight":2},
        filter: function (feature, layer) {
          return feature.properties.continent == "Africa";
        },
        onEachFeature: onEachFeature,
      });
      function loadGeojson(data) {
        paisesG.addData(data);
        map.addLayer(paisesG);
      }
      $.ajax({
        url: URL,
        dataType: "json",
        success: loadGeojson,
      });
    </script>
  </body>
</html>
