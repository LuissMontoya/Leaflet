<!DOCTYPE html>
<html>
  <meta charset="utf-8" />
  <head>

    <script src=" https://unpkg.com/leaflet@1.6.0/dist/leaflet.js "></script>
    <link rel="stylesheet" href=" https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />

    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>

    <script src="leaflet-search-master\src\leaflet-search.js"></script>
    <link rel="stylesheet" href="leaflet-search-master\src\leaflet-search.css" />

    <style>
      #map {
        width: 100%;
        height: 600px;
        box-shadow: 5px 5px 5px #888;
      }
      .info {
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
      }
      .info h2 {
        color: rgb(5, 46, 249);
        margin: 0 0 5px;

      }
    </style>

  </head>
  
  <body>
    <div id="map"></div>
    <script>

var osm = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          attribution:
            '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>' +
            "contributors",
          maxZoom: 18,
        }
      );

      var osmg = L.tileLayer(
        "http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",
        {
          attribution:
            '&copy; <a href="google.com">OpenStreetMap</a>' + "contributors",
          maxZoom: 18,
        }
      );

      var limiteMunicipios = L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
        layers: "limites_municipios",
        format: "image/png",
        transparent: true,
        tiled: true,
        attribution: "earth",
      });

      var departamentos = L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
        layers: "departamentos",
        format: "image/png",
        transparent: true,
        tiled: true,
        attribution: "earth",
      });
      
      function style(feature) {
        return {
          fillColor: getColor(feature.properties.distrito),
          weight: 2,
          opacity: 1,
          color: "white",
          dashArray: "3",
          fillOpacity: 0.7,
        };
      }

      function getColor(d) {
        if (d == "Altiplano") {
          return "#2980b9";
        } 
        if(d =="Santanderes"){
            return "#3498db";
        }
        if(d == "Belmira"){
            return "#2ecc71";
        }
        if(d == "Boyacá"){
            return "#2ecc71";
        }
        if(d == "Picachos"){
            return "#27ae60";
        }
        else
        return "#d35400";
      }

      function brillo(e) {
        var layer = e.target;
        layer.setStyle({
          fillColor: "yellow",
          weight: 5,
          color: "#666",
          dashArray: "",
          fillOpacity: 0.2,
        });
      }

      function ResetLuz(e) {
        paramos.resetStyle(e.target);
      }

      function Zoomem(e) {
        map.fitBounds(e.target.getBounds());
      }

      var owsrootUrl = "http://localhost:8080/geoserver/ows";

      var defaultParameters = {
        service: "WFS",
        version: "1.0.0", 
        request: "GetFeature",
        typeName: "earth:paramos",
        outputFormat: "application/json"
      };

      var parameters = L.Util.extend(defaultParameters);
      var URL = owsrootUrl + L.Util.getParamString(parameters);
      
      var paramos = new L.geoJson(null, {
        style: style,
        onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.distrito),
            layer.on({
              mouseover: brillo, 
              mouseout: ResetLuz, 
              click: Zoomem
            }); 
        },
      });

    
      var map = L.map("map", {
        center: [4.71191991021761, -74.0713838345398],
        zoom: 6,
        layers: [osm, limiteMunicipios, departamentos],
        scrollWheelZoom: true,
      });

      var baseMaps = {
        "Open Street Map": osm,
        "Google Earth": osmg,
      };

      var overlayMaps = {
        "Páramos": paramos,
        "Limites Municipales": limiteMunicipios,
        "Departamentos": departamentos
      };

      L.control.scale({ imperial: false }).addTo(map);


      var title = L.control();
      title.onAdd = function (map) {
        var div = L.DomUtil.create("div", "info");
        div.innerHTML += "<h2>Parcial Unidad 5 </h2> Luis Fernando Montoya Parra";
        return div;
      };
      title.addTo(map);

      var legend = L.control({ position: "bottomright" });
      legend.onAdd = function (map) {
        var div = L.DomUtil.create("div", "info legend");
        div.innerHTML +=
          '<img src="http://localhost:8080/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=parcial" height="100">';
        return div;
      };
      legend.addTo(map);

      var searchControl = new L.Control.Search({
        layer: paramos,
        marker: false,
        propertyName: "complejo",
      });

      searchControl
        .on("search:locationfound", function (e) {
          e.layer.setStyle({ fillColor: "#3f0", color: "#0f0" });
        })
        .on("search:collapsed", function (e) {
            paramos.eachLayer(function (layer) {
                paramos.resetStyle(layer);
          });
        });

      function loadGeojson(data) {
        paramos.addData(data);
        map.addLayer(paramos);
      }

      $.ajax({
        url: URL,
        dataType: "json",
        success: loadGeojson,
      });

      L.control.layers(baseMaps, overlayMaps, searchControl).addTo(map);
      map.addControl(searchControl);


    </script>
  </body>
</html>
